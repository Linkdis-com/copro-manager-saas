import{c as $,u as Fe,a as De,r as o,j as e,R as ee,C as te,F as se,b as Te,d as Se,e as _e,A as ke,f as ae,D as Me,g as $e,h as Ee,P as re,B as Le,X as Ae,S as Re,i as F,w as Pe,t as Ye}from"./index-S-2_z93G.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=$("ChevronsDown",[["path",{d:"m7 6 5 5 5-5",key:"1lc07p"}],["path",{d:"m7 13 5 5 5-5",key:"1d48rs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=$("ChevronsUp",[["path",{d:"m17 11-5-5-5 5",key:"e8nh98"}],["path",{d:"m17 18-5-5-5 5",key:"2avn1x"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=$("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=$("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),le=[{value:"recuperable_locataire",label:"RÃ©cupÃ©rable Locataire",icon:"âœ…",color:"bg-green-100 text-green-700"},{value:"non_recuperable",label:"Non RÃ©cupÃ©rable",icon:"âŒ",color:"bg-red-100 text-red-700"},{value:"eau",label:"Eau",icon:"ðŸ’§",color:"bg-blue-100 text-blue-700"},{value:"chauffage",label:"Chauffage",icon:"ðŸ”¥",color:"bg-orange-100 text-orange-700"},{value:"electricite",label:"Ã‰lectricitÃ©",icon:"âš¡",color:"bg-yellow-100 text-yellow-700"},{value:"entretien",label:"Entretien",icon:"ðŸ”§",color:"bg-gray-100 text-gray-700"},{value:"ascenseur",label:"Ascenseur",icon:"ðŸ›—",color:"bg-purple-100 text-purple-700"},{value:"assurance",label:"Assurance",icon:"ðŸ›¡ï¸",color:"bg-indigo-100 text-indigo-700"},{value:"frais_bancaires",label:"Frais bancaires",icon:"ðŸ¦",color:"bg-slate-100 text-slate-700"}],M=[{border:"border-l-cyan-500",bg:"bg-cyan-50",text:"text-cyan-700"},{border:"border-l-purple-500",bg:"bg-purple-50",text:"text-purple-700"},{border:"border-l-amber-500",bg:"bg-amber-50",text:"text-amber-700"},{border:"border-l-emerald-500",bg:"bg-emerald-50",text:"text-emerald-700"},{border:"border-l-rose-500",bg:"bg-rose-50",text:"text-rose-700"},{border:"border-l-blue-500",bg:"bg-blue-50",text:"text-blue-700"},{border:"border-l-orange-500",bg:"bg-orange-50",text:"text-orange-700"},{border:"border-l-indigo-500",bg:"bg-indigo-50",text:"text-indigo-700"}],Ue=()=>{const h=new Date().getFullYear();return[h,h-1,h-2,h-3,h-4]};function Ge({immeubleId:h,proprietaires:y}){Fe();const{getTransactions:ne}=De(),ie=new Date().getFullYear(),E=o.useMemo(()=>Ue(),[]),[C,B]=o.useState("situation"),[m,I]=o.useState(ie),[oe,O]=o.useState(!0),[He,U]=o.useState([]),[L,H]=o.useState({}),[z,A]=o.useState({}),[D,ce]=o.useState(!1),[T,de]=o.useState(""),[S,xe]=o.useState("all"),[R,_]=o.useState(null),[w,G]=o.useState({description:"",tags:[]}),[J,X]=o.useState(!1),[c,k]=o.useState(null);o.useEffect(()=>{K()},[h]);const K=async(t=!1)=>{try{O(!0);const s=await ne(h,t);U(s);const r={};E.forEach(a=>{r[a]=s.filter(l=>{const i=l.date_transaction||l.date_comptabilisation||l.created_at;return i?new Date(i).getFullYear()===a:!1})}),H(r)}catch(s){console.error("Error loading data:",s),U([]),H({})}finally{O(!1)}},j=o.useMemo(()=>L[m]||[],[L,m]),P=t=>{const s=(t.description||t.communication||"").toLowerCase();return s.includes("frais")||s.includes("non-execute")||s.includes("non execute")||s.includes("participation aux frais")},p=t=>t.type==="charge"?P(t)?"frais":"charge":"depot",f=o.useMemo(()=>{const t=y.reduce((a,l)=>a+(l.nombre_parts||l.milliemes||0),0),s=j.filter(a=>a.type==="charge"&&!P(a)).reduce((a,l)=>a+Math.abs(parseFloat(l.montant||0)),0),r=j.filter(a=>a.type==="charge"&&P(a)).reduce((a,l)=>a+Math.abs(parseFloat(l.montant||0)),0);return y.map((a,l)=>{const i=a.nombre_parts||a.milliemes||0,d=t>0?i/t:0,b=s*d,x=r*d,W=j.filter(v=>{if(v.type==="charge")return!1;const q=(v.nom_contrepartie||"").toLowerCase(),Ce=(v.communication||v.description||"").toLowerCase();return q.includes(a.nom.toLowerCase())||Ce.includes(a.nom.toLowerCase())}).reduce((v,q)=>v+Math.abs(parseFloat(q.montant||0)),0),Z=W-b-x;return{id:a.id,nom:`${a.prenom||""} ${a.nom}`.trim(),milliemes:i,totalMilliemes:t,pourcentage:(d*100).toFixed(2),soldeDebut:0,charges:b,depots:W,frais:x,soldeFinal:Z,statut:Z>=0?"a_jour":"attention",color:M[l%M.length]}})},[j,y]),N=o.useMemo(()=>f.reduce((t,s)=>({charges:t.charges+s.charges,depots:t.depots+s.depots,frais:t.frais+s.frais,soldeFinal:t.soldeFinal+s.soldeFinal}),{charges:0,depots:0,frais:0,soldeFinal:0}),[f]),me=t=>{const s=y.reduce((a,l)=>a+(l.nombre_parts||l.milliemes||0),0),r=Math.abs(parseFloat(t.montant||0));return y.map((a,l)=>{const i=a.nombre_parts||a.milliemes||0,d=s>0?i/s:0;return{id:a.id,nom:`${a.prenom||""} ${a.nom}`.trim(),montant:r*d,color:M[l%M.length]}})},Q=t=>{if(p(t)==="depot"){const r=(t.nom_contrepartie||"").toLowerCase(),a=(t.communication||t.description||"").toLowerCase();for(const l of y)if(r.includes(l.nom.toLowerCase())||a.includes(l.nom.toLowerCase()))return l}return null},n=t=>new Intl.NumberFormat("fr-BE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t||0)+" â‚¬",Y=t=>t?new Date(t).toLocaleDateString("fr-BE"):"-",pe=t=>{A(s=>({...s,[t]:!s[t]}))},he=()=>{if(D)A({});else{const t={};g.forEach(s=>{const r=p(s);(r==="charge"||r==="frais")&&(t[s.id]=!0)}),A(t)}ce(!D)},ge=()=>{const t=g.map(a=>{const l=p(a),i=Math.abs(parseFloat(a.montant||0)),d=a.date_transaction||a.date_comptabilisation,b=Q(a),x=l==="depot"&&b?`${b.prenom||""} ${b.nom}`.trim():a.nom_contrepartie||"-";return{Date:Y(d),Description:a.description||a.communication||"-",Type:l==="depot"?"DÃ©pÃ´t":l==="frais"?"Frais":"Charge",Contrepartie:x,Montant:(l==="depot"?"":"-")+n(i)}});t.push({}),t.push({Date:"RÃ‰SUMÃ‰ "+m}),t.push({Date:"Total Charges",Montant:n(u.totalCharges)}),t.push({Date:"Total Frais",Montant:n(u.totalFrais)}),t.push({Date:"Total DÃ©pÃ´ts",Montant:n(u.totalDepots)}),t.push({Date:"Solde",Montant:n(u.totalDepots-u.totalCharges-u.totalFrais)});const s=F.json_to_sheet(t),r=F.book_new();if(F.book_append_sheet(r,s,`Historique ${m}`),f.length>0){const a=f.map(i=>({PropriÃ©taire:i.nom,MilliÃ¨mes:`${i.milliemes}/${i.totalMilliemes}`,"%":i.pourcentage+"%",Charges:n(i.charges),Frais:n(i.frais),DÃ©pÃ´ts:n(i.depots),Solde:n(i.soldeFinal),Statut:i.statut==="a_jour"?"Ã€ jour":"Attention"})),l=F.json_to_sheet(a);F.book_append_sheet(r,l,`Situation ${m}`)}Pe(r,`comptabilite_${m}.xlsx`)},g=o.useMemo(()=>j.filter(t=>{const s=(t.description||t.communication||t.nom_contrepartie||"").toLowerCase(),r=p(t);return!(T&&!s.includes(T.toLowerCase())||S!=="all"&&r!==S)}),[j,T,S]),u=o.useMemo(()=>({total:g.length,totalCharges:g.filter(t=>p(t)==="charge").reduce((t,s)=>t+Math.abs(parseFloat(s.montant||0)),0),totalFrais:g.filter(t=>p(t)==="frais").reduce((t,s)=>t+Math.abs(parseFloat(s.montant||0)),0),totalDepots:g.filter(t=>p(t)==="depot").reduce((t,s)=>t+Math.abs(parseFloat(s.montant||0)),0)}),[g]),ue=t=>{k(t)},be=(t,s)=>{s.stopPropagation(),_(t),G({description:t.description||t.communication||"",tags:t.tags||[]})},ye=async()=>{if(R)try{X(!0),await Ye.update(h,R.id,{tags:w.tags,categorie:w.tags.length>0?w.tags[0]:null}),_(null),K()}catch(t){console.error("Error updating:",t),alert("Erreur lors de la mise Ã  jour")}finally{X(!1)}},je=t=>{G(s=>({...s,tags:s.tags.includes(t)?s.tags.filter(r=>r!==t):[...s.tags,t]}))},fe=t=>{switch(p(t)){case"depot":return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded bg-green-500 text-white",children:"DÃ©pÃ´t"});case"frais":return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded bg-amber-500 text-white",children:"Frais"});default:return e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded bg-red-500 text-white",children:"Charge"})}},Ne=t=>!t||t.length===0?null:e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.map(s=>{const r=le.find(a=>a.value===s);return r?e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${r.color}`,children:r.icon},s):null})});if(oe)return e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ee,{className:"h-6 w-6 animate-spin text-primary-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Chargement..."})]})});const we=f.filter(t=>t.statut==="a_jour").length,ve=f.filter(t=>t.statut==="attention").length,V=c?j.filter(t=>{if(t.type==="charge")return!0;const s=(t.nom_contrepartie||"").toLowerCase(),r=(t.communication||t.description||"").toLowerCase();return s.includes(c.nom.toLowerCase())||r.includes(c.nom.toLowerCase())}):[];return e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"p-4 sm:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(te,{className:"h-6 w-6 text-amber-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ComptabilitÃ©"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>{B("situation"),k(null)},className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors flex items-center gap-2 ${C==="situation"?"bg-primary-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(te,{className:"h-4 w-4"}),"Situation"]}),e.jsxs("button",{onClick:()=>{B("historique"),k(null)},className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors flex items-center gap-2 ${C==="historique"?"bg-primary-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(se,{className:"h-4 w-4"}),"Historique"]})]})]}),C==="situation"&&!c&&e.jsxs("div",{children:[e.jsxs("div",{className:"p-4 bg-gray-50 border-b flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-primary-600"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Exercice comptable"})]}),e.jsx("select",{value:m,onChange:t=>I(parseInt(t.target.value)),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white font-semibold text-primary-700 focus:ring-2 focus:ring-primary-500",children:E.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 p-4 border-b",children:[e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Total charges"}),e.jsx("p",{className:"text-lg font-bold text-red-600",children:n(N.charges)})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Total dÃ©pÃ´ts"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:n(N.depots)})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Ã€ jour"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:we})]}),e.jsxs("div",{className:"text-center p-3 bg-amber-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Attention"}),e.jsx("p",{className:"text-lg font-bold text-amber-600",children:ve})]})]}),y.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(Se,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Aucun propriÃ©taire configurÃ©"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"PropriÃ©taire"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"MilliÃ¨mes"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Charges"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase hidden md:table-cell",children:"DÃ©pÃ´ts"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase hidden lg:table-cell",children:"Frais"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Solde"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:"Statut"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase w-16",children:"DÃ©tail"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map(t=>e.jsxs("tr",{className:`hover:bg-gray-50 ${t.soldeFinal<-100?"bg-red-50":t.soldeFinal<0?"bg-amber-50":""}`,children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-1 h-8 ${t.color.border.replace("border-l-","bg-")} rounded mr-2`}),e.jsx("span",{className:"font-medium text-gray-900",children:t.nom})]})}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-600",children:[t.milliemes,"/",t.totalMilliemes," (",t.pourcentage,"%)"]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-right text-red-600",children:n(t.charges)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-right text-green-600 hidden md:table-cell",children:n(t.depots)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-right text-amber-600 hidden lg:table-cell",children:n(t.frais)}),e.jsx("td",{className:`px-4 py-3 whitespace-nowrap text-sm text-right font-bold ${t.soldeFinal>=0?"text-green-600":"text-red-600"}`,children:n(t.soldeFinal)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center",children:t.statut==="a_jour"?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(_e,{className:"h-3 w-3 mr-1"}),"Ã€ jour"]}):e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-800",children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),"Attention"]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{onClick:()=>ue(t),className:"p-2 text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"Voir le dÃ©tail",children:e.jsx(Ie,{className:"h-4 w-4"})})})]},t.id))}),e.jsx("tfoot",{className:"bg-gray-100",children:e.jsxs("tr",{className:"font-semibold",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:"TOTAL"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-red-600",children:n(N.charges)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-green-600 hidden md:table-cell",children:n(N.depots)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-amber-600 hidden lg:table-cell",children:n(N.frais)}),e.jsx("td",{className:`px-4 py-3 text-sm text-right font-bold ${N.soldeFinal>=0?"text-green-600":"text-red-600"}`,children:n(N.soldeFinal)}),e.jsx("td",{className:"px-4 py-3",children:"-"}),e.jsx("td",{className:"px-4 py-3",children:"-"})]})})]})})]}),C==="situation"&&c&&e.jsxs("div",{children:[e.jsx("div",{className:"p-4 bg-gray-50 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>k(null),className:"p-2 hover:bg-gray-200 rounded-lg",children:e.jsx(ae,{className:"h-5 w-5 rotate-[-90deg]"})}),e.jsx("div",{className:`w-1 h-10 ${c.color.border.replace("border-l-","bg-")} rounded`}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:c.nom}),e.jsxs("p",{className:"text-sm text-gray-500",children:[c.milliemes,"/",c.totalMilliemes," milliÃ¨mes (",c.pourcentage,"%)"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Solde ",m]}),e.jsx("p",{className:`text-2xl font-bold ${c.soldeFinal>=0?"text-green-600":"text-red-600"}`,children:n(c.soldeFinal)})]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-4 border-b",children:[e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Charges"}),e.jsx("p",{className:"text-lg font-bold text-red-600",children:n(c.charges)})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"DÃ©pÃ´ts"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:n(c.depots)})]}),e.jsxs("div",{className:"text-center p-3 bg-amber-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Frais"}),e.jsx("p",{className:"text-lg font-bold text-amber-600",children:n(c.frais)})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("h5",{className:"font-medium text-gray-700 mb-3",children:["Transactions ",m]}),V.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Aucune transaction"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:V.map(t=>{const s=p(t),r=Math.abs(parseFloat(t.montant||0)),a=t.date_transaction||t.date_comptabilisation,l=s==="charge"||s==="frais";let i=r;if(l){const d=parseFloat(c.pourcentage)/100;i=r*d}return e.jsx("div",{className:`p-3 rounded-lg border ${s==="depot"?"bg-green-50 border-green-200":s==="frais"?"bg-amber-50 border-amber-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:t.description||t.communication||"-"}),e.jsx("p",{className:"text-xs text-gray-500",children:Y(a)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:`font-bold ${s==="depot"?"text-green-600":s==="frais"?"text-amber-600":"text-red-600"}`,children:[s==="depot"?"+":"-",n(i)]}),l&&e.jsxs("p",{className:"text-xs text-gray-400",children:["sur ",n(r)," total"]})]})]})},t.id)})})]})]}),C==="historique"&&e.jsxs("div",{children:[e.jsx("div",{className:"border-b border-gray-200 bg-gray-50",children:e.jsx("div",{className:"flex overflow-x-auto",children:E.map(t=>e.jsxs("button",{onClick:()=>I(t),className:`px-6 py-3 text-sm font-medium whitespace-nowrap border-b-2 transition-colors ${m===t?"border-primary-600 text-primary-600 bg-white":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[t,e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full bg-gray-200 text-gray-600",children:(L[t]||[]).length})]},t))})}),e.jsx("div",{className:"p-4 bg-gradient-to-r from-primary-50 to-blue-50 border-b",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:"Charges:"})," ",e.jsx("span",{className:"text-red-600 font-semibold",children:n(u.totalCharges)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:"Frais:"})," ",e.jsx("span",{className:"text-amber-600 font-semibold",children:n(u.totalFrais)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-medium",children:"DÃ©pÃ´ts:"})," ",e.jsx("span",{className:"text-green-600 font-semibold",children:n(u.totalDepots)})]})]})}),e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher...",value:T,onChange:t=>de(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("select",{value:S,onChange:t=>xe(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"all",children:"Tout afficher"}),e.jsx("option",{value:"charge",children:"Charges"}),e.jsx("option",{value:"frais",children:"Frais"}),e.jsx("option",{value:"depot",children:"DÃ©pÃ´ts"})]}),e.jsxs("button",{onClick:he,className:`px-4 py-2 rounded-lg border flex items-center gap-2 ${D?"bg-primary-50 border-primary-300 text-primary-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[D?e.jsx(Be,{className:"h-4 w-4"}):e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"DÃ©tails"})]}),e.jsxs("button",{onClick:ge,className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Export"})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase w-10"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase w-24",children:"Date"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Description"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase w-20",children:"Type"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase w-36",children:"Contrepartie"}),e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase w-28",children:"Montant"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase w-16",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"p-8 text-center text-gray-500",children:[e.jsx(se,{className:"h-12 w-12 mx-auto text-gray-300 mb-4"}),e.jsxs("p",{children:["Aucune transaction pour ",m]})]})}):g.map(t=>{const s=Math.abs(parseFloat(t.montant||0)),r=p(t),a=r==="charge"||r==="frais",l=t.date_transaction||t.date_comptabilisation||t.created_at,i=t.description||t.communication||"-",d=Q(t),b=r==="depot"&&d?`${d.prenom||""} ${d.nom}`.trim():t.nom_contrepartie||"-";return e.jsxs($e.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-gray-50 ${r==="charge"?"bg-red-50/30":r==="frais"?"bg-amber-50/30":"bg-green-50/30"}`,children:[e.jsx("td",{className:"px-2 py-3",children:a&&e.jsx("button",{onClick:()=>pe(t.id),className:"p-1 rounded hover:bg-gray-200",children:z[t.id]?e.jsx(ae,{className:"h-4 w-4"}):e.jsx(Ee,{className:"h-4 w-4"})})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap text-sm text-gray-600",children:Y(l)}),e.jsxs("td",{className:"px-3 py-3",children:[e.jsx("div",{className:"text-sm text-gray-900 truncate max-w-xs",title:i,children:i}),Ne(t.tags)]}),e.jsx("td",{className:"px-3 py-3",children:fe(t)}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("span",{className:"text-sm text-gray-600 truncate block max-w-[140px]",title:b,children:b})}),e.jsxs("td",{className:`px-3 py-3 text-right font-semibold whitespace-nowrap ${r==="depot"?"text-green-600":r==="frais"?"text-amber-600":"text-red-600"}`,children:[r==="depot"?"+":"-",n(s)]}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsx("button",{onClick:x=>be(t,x),className:"p-2 text-orange-500 hover:bg-orange-50 rounded",title:"Ã‰diter",children:e.jsx(re,{className:"h-4 w-4"})})})]}),z[t.id]&&a&&e.jsx("tr",{className:"bg-gray-50",children:e.jsx("td",{colSpan:"7",className:"px-4 py-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 border",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-primary-600"}),"RÃ©partition par propriÃ©taire"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3",children:me(t).map(x=>e.jsxs("div",{className:`rounded-lg p-3 border-l-4 ${x.color.border} ${x.color.bg}`,children:[e.jsx("p",{className:"text-xs text-gray-500",children:x.nom}),e.jsx("p",{className:`text-lg font-bold ${x.color.text}`,children:n(x.montant)})]},x.id))})]})})})]},t.id)})})]})})]}),R&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-orange-500"}),"Ã‰diter les tags"]}),e.jsx("button",{onClick:()=>_(null),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Ae,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("div",{className:"w-full px-3 py-3 border border-gray-200 rounded-lg bg-gray-50 text-gray-700 text-sm",children:w.description||"-"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags"}),e.jsx("div",{className:"border border-gray-300 rounded-lg p-2 max-h-64 overflow-y-auto space-y-1",children:le.map(t=>e.jsxs("label",{className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-colors ${w.tags.includes(t.value)?"bg-primary-50 border border-primary-200":"hover:bg-gray-50"}`,children:[e.jsx("input",{type:"checkbox",checked:w.tags.includes(t.value),onChange:()=>je(t.value),className:"rounded border-gray-300 text-primary-600 h-4 w-4"}),e.jsx("span",{className:"text-lg",children:t.icon}),e.jsx("span",{className:"text-sm",children:t.label})]},t.value))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:ye,disabled:J,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:[J?e.jsx(ee,{className:"h-4 w-4 animate-spin"}):e.jsx(Re,{className:"h-4 w-4"}),"Sauvegarder"]}),e.jsx("button",{onClick:()=>_(null),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Annuler"})]})]})})})]})}export{Ge as default};
